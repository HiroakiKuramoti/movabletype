<table id="js-table-<mt:var name="content_field_id" escape="html">" style="display: none">
<mt:var name="table_value">
</table>
<input type="hidden" id="content-field-<mt:var name="content_field_id" escape="html">" name="content-field-<mt:var name="content_field_id" escape="html">" value="" mt:raw-name="1" />

<mt:setvarblock name="jq_js_include" append="1">
(function() {
  var changeableColumns = <mt:if name="options{changeable_columns}">true<mt:else>false</mt:if>;
  var changeableRows = <mt:if name="options{changeable_rows}">true<mt:else>false</mt:if>;
  var fieldId = '<mt:var name="content_field_id" escape="js">';
  var languageTag = '<mt:var name="language_tag" escape="js">';

  var table = new aTable(
    '#js-table-' + fieldId,
    {
      changeableColumns: changeableColumns,
      changeableRows: changeableRows,
      lang: languageTag
    }
  );

  table.afterAction =
  table.afterEntered = function() {
    setDirty(true);
    log('found dirty form: #js-table-' + fieldId);
    (app.getIndirectMethod('setDirty'))();
  };

  function updateTableInputValue() {
    var tableInnerHtml = jQuery(table.getTable()).children().html();
    jQuery('#content-field-' + fieldId).val(tableInnerHtml);
  }

  jQuery(window).on('pre_autosave', function() {
    updateTableInputValue();
  });

  jQuery('form#edit-content-type-data-form').submit(function() {
    updateTableInputValue();
  });
})();
</mt:setvarblock>


<mt:var name="screen_type" value="dialog-screen insert-content-data-dialog">
<mt:setvarblock name="html_head" append="1">
<style>
#container {
    height: 100%;
}

#content {
    height: 100%;
    padding: 0px;
}

#content-body {
    margin-top: 0px;
    height: 100%;
    min-height: 100%;
}

#content-body-left {
    float: left;
    width: 135px;
}

#content-body-right {
    float: right;
    margin: 0 15px 0 -150px;
    width: 100%;
    height: 100%;
    min-height: 100%;
}

#content-body-right-body {
    padding: 15px 0 0 15px;
    margin: 0 0 0 150px;
    height: 100%;
    min-height: 100%;
    border-left: solid 1px #aaa;
}

#content-data-menu li {
    margin-bottom: 0px;
    list-style-type: none;
    height: 50px;
    border-bottom: solid 1px #aaa;
    line-height: 50px;
    padding-left: .5em;
}

#content-data-menu li.last-child {
    border-bottom: solid 1px #aaa;
}

#content-data-menu li.active {
    background-color: #cae5f8
}
</style>
</mt:setvarblock>

<mt:include name="dialog/header.tmpl">

<div id="content-body-right">
  <div id="content-body-right-body">
    <div id="select-content-data-panel" class="panel">
<mt:include name="include/content_data_list.tmpl" dialog="1" component="ContentType">
    </div>
<mt:if name="can_add">
    <div id="create-content-data-panel" class="hidden panel">
      create content data
    </div>
</mt:if>
  </div>
</div>

<div id="content-body-left">
  <div id="content-data-menu">
    <li class="active">
      <a href="#" class="left-menu-item" data-panel-id="#select-content-data-panel">
        <__trans phrase="Select">
      </a>
    </li>
<mt:if name="can_add">
    <li>
      <a href="#" class="left-menu-item" data-panel-id="#create-content-data-panel">
        <__trans phrase="Create">
      </a>
    </li>
</mt:if>
  </div>
</div>

<div class="dialog-screen">
  <div class="actions-bar actions-bar-bottom">
    <form action="" method="get" onsubmit="return false">
      <button
        type="submit"
        accesskey="s"
        title="<__trans phrase="Insert (s)">"
        class="action primary button close disabled"
        disabled="true">
        <__trans phrase="Insert">
      </button>
      <button
        type="submit"
        accesskey="x"
        class="cancel action button mt-close-dialog"
        title="<__trans phrase="Cancel (x)">">
        <__trans phrase="Cancel">
      </button>
    </form>
  </div>
</div>

<mt:setvarblock name="jq_js_include" append="1">
<mt:if name="can_add">
var currentPanel = '#create-content-data-panel';
<mt:else>
var currentPanel = '#select-content-data-panel';
</mt:if>
jQuery('.left-menu-item').click(function () {
  // Make custom event
  var event = new jQuery.Event('changePanel');

  currentPanel = jQuery(this).attr('data-panel-id');
  jQuery('#select_content_data input[name="id"]').val('');

  jQuery('.actions-bar button.primary')
    .attr('disabled', 'disabled')
    .addClass('disabled');
  jQuery('div.panel')
    .addClass('hidden')
    .hide();
  jQuery(currentPanel)
    .removeClass('hidden')
    .show()
    .trigger(event);
  jQuery(this)
    .parent('li')
    .siblings()
    .removeClass('active');
  jQuery(this)
    .parent('li')
    .addClass('active');

  var buttonText;
  if (currentPanel === '#create-content-data-panel') {
    buttonText = '<__trans phrase="Create and Insert">';
  } else if (currentPanel === '#select-content-data-panel') {
    buttonText = '<__trans phrase="Insert">';
  }
  jQuery('button.primary').text(buttonText);
});
jQuery('.actions-bar button.primary').click(function() {
  var contentFieldId = '<mt:var name="content_field_id" escape="js">';
  var canMulti = <mt:if name="can_multi">true<mt:else>false</mt:if>;

  var $ul = parent.jQuery('#content-field-' + contentFieldId + '-list-content-data')
  $ul.children('li.empty-content-data-list').remove();
  if (!canMulti) {
    $ul.children().remove();
  }

  var getEditUrl = function (id) {
    var query = {
      __mode: 'edit_content_data',
      blog_id: '<mt:var name="blog_id" escape="js">',
      content_type_id: '<mt:var name="content_type_id" escape="js">',
      id: id
    };
    return '<mt:var name="script_url">?' + jQuery.param(query);
  };

  jQuery('input[name=id]:checked').each(function (i, e) {
    var id = e.value;
    if ($ul.find('input[value=' + id + ']').length) {
      return;
    }

    var title = jQuery(e).parent().next().text();
    var editUrl = getEditUrl(id);
    var $inputId = jQuery('<input/>').attr({type: 'hidden', name: 'content-field-' + contentFieldId}).val(id);
    var $editAnchor = jQuery('<a/>').attr({href: editUrl, target: '_blank'}).text(title);
    var $removeAnchor = jQuery('<a/>').addClass('icon-remove icon16 action-icon')
                                      .css('cursor', 'pointer')
                                      .attr('href', 'javascript:void(0)');
    var $li = jQuery('<li/>').append($inputId, $editAnchor, $removeAnchor);
    $ul.append($li);
  });

  var $container = parent.jQuery('#content-type-field-' + contentFieldId);
  var ns = parent.jQuery.data($container.get(0), 'mtValidator');
  if (ns) {
    $container.mtValid({ focus: false });
  }

  log('found dirty form');
  parent.app.setDirty();

  parent.jQuery.fn.mtDialog.close();
  return false;
});
</mt:setvarblock>

<mt:include name="dialog/footer.tmpl">


<mt:loop name="list_value">
<div style="display: inline">
  <input type="text" name="content-field-<mt:var name="content_field_id" escape="html">" class="text long" value="<mt:var name="__value__">" mt:watch-change="1" mt:raw-name="1" style="width: 95%" />
  <a href="javascript:void(0)" onclick="removeList(this)"><img src="<mt:var name="static_uri">images/status_icons/close.gif" /></a>
</div>
</mt:loop>

<a href="javascript:void(0)" onclick="addList(this)"><img src="<mt:var name="static_uri">images/status_icons/create.gif" /></a>

<script>
var fieldId = '<mt:var name="content_field_id" escape="js">';
var required = <mt:if name="options{required}">true<mt:else>false</mt:if>;

function checkRequired () {
  if (!required) return;
  var $lists = jQuery(`input[name=content-field-${fieldId}]`);
  if ($lists.length === 1 && $lists.next('a')) {
    $lists.next('a').remove();
  } else {
    $lists.each(function (index) {
      if (jQuery(this).next('a').length > 0) return;
      jQuery(this).after('  <a href="javascript:void(0)" onclick="removeList(this)"><img src="<mt:var name="static_uri">images/status_icons/close.gif" /></a>');
    });
  }
}

checkRequired();

function removeList(removeButton) {
  jQuery(removeButton).parent().remove();
  checkRequired();
  setDirty(true);
  log('found dirty form: removed list element');
  (app.getIndirectMethod('setDirty'))();
}

function addList(createButton) {
  var newDiv = '<div style="display: inline">' + "\n";
  newDiv    += '  <input type="text" name="content-field-<mt:var name="content_field_id" escape="html">" class="text long" value="" mt:raw-name="1" style="width: 95%" />' + "\n";
  newDiv    += '  <a href="javascript:void(0)" onclick="removeList(this)"><img src="<mt:var name="static_uri">images/status_icons/close.gif" /></a>' + "\n";
  newDiv    += '</div>' + "\n";

  var $newDiv = jQuery(newDiv);
  log('adding watcher to content-type-<mt:var name="content_field_id" escape="js">');
  DOM.addEventListener($newDiv.get(0), 'change', app.getIndirectEventListener('setDirty'));

  jQuery(createButton).before($newDiv);

  checkRequired();
  setDirty(true);
  log('found dirty form: added list element');
  (app.getIndirectMethod('setDirty'))();
}
</script>


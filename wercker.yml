box: masiuchi/docker-mt-test:trusty-full

build:
  steps:
    - script:
        name: Remove skip test
        code: |
          rm t/34-sqlite.t
          rm t/90-podcoverage.t
          rm plugins/MultiBlog/t/02.tags.t
    - script:
        name: Install CPAN modules
        code: |
          cpm install -g --test --cpanfile=t/cpanfile
    - script:
        name: Start mysql and memcached
        code: |
          find /var/lib/mysql -type f | xargs touch
          service mysql start
          service memcached start
    - script:
        name: Run test
        code: |
          cp t/mysql-test.cfg mt-config.cgi

          prove t plugins/*/t
          phpunit


<mt:include name="dialog/header.tmpl">
<mt:setvarblock name="insert_script" id="insert_script">
window.parent.app.insertHTML( '<mt:var name="upload_html" escape="js">', '<mt:var name="edit_field" escape="js">' );
</mt:setvarblock>
<script type="text/javascript">
/* <![CDATA[ */

// do the following first... asset manager stuff is ONLY for edit entry
<mt:if name="upload_html">
  <mt:var name="insert_script">
</mt:if>

<mt:if name="content_field_id">
  <mt:setvarblock name="id_prefix">content-field-<mt:var name="content_field_id">-</mt:setvarblock>
</mt:if>

// Set dirty flag
window.parent.app.setDirty();
 
// remove the no assets text if it's there
var Node = window.parent.document.getElementById("<mt:var name="id_prefix">empty-asset-list");
if (Node) {
    Node.parentNode.removeChild(Node);
} 

// make sure asset list is present in an entry edit page
var AssetList = window.parent.document.getElementById("<mt:var name="id_prefix">asset-list");

if (AssetList) {
    // make sure the asset isn't there already and that we're in the edit entry page
    var Asset;
<mt:Assets>
  <mt:setvarblock name="asset_class"><mt:AssetProperty property="class"></mt:setvarblock>

    Asset = window.parent.document.getElementById("<mt:var name="id_prefix">list-asset-<mt:AssetID>");

    if (Asset) {
        // do nothing
    }
    else {
        // add the asset's id to the include_asset_ids hidden input
        var asset_ids = window.parent.document.getElementById("<mt:var name="id_prefix">include_asset_ids").value;
        if ( asset_ids.length > 0 ) {
            asset_ids += ',';
        }
        window.parent.document.getElementById("<mt:var name="id_prefix">include_asset_ids").value = asset_ids + "<mt:AssetID>";

        // create the link to the asset page with asset name as label
        var myAssetLink = window.document.createElement('a');
        myAssetLink.setAttribute('href', '<mt:var name="script_url">?__mode=view&_type=asset&blog_id=<mt:AssetBlogID>&id=<mt:AssetID>');
        myAssetLink.setAttribute('class', 'asset-title');
        myAssetLink.appendChild(document.createTextNode('<mt:if name="id_prefix"><mt:AssetLabel encode_js="1"><mt:else><mt:AssetFileName encode_js="1"></mt:if>'));

        // create the remove link for this asset
        var myRemoveLink = window.document.createElement('a');
        myRemoveLink.setAttribute('href', 'javascript:removeAssetFromList(<mt:AssetID><mt:if name="id_prefix">, \'<mt:var name="id_prefix" escape="js">\'</mt:if>)');
        myRemoveLink.setAttribute('title', '<__trans phrase="Remove this asset.">');
        myRemoveLink.setAttribute('class', 'remove-asset icon-remove icon16 action-icon');
        myRemoveLink.appendChild(document.createTextNode('<__trans phrase="Remove">'));

        // create the asset list item
        var myElement = window.document.createElement('li');
        myElement.setAttribute('id', '<mt:var name="id_prefix">list-asset-<mt:AssetID>');
        myElement.setAttribute('class', 'asset-type-<mt:AssetProperty property="class"$>');
        <mt:If name="asset_class" eq="image">
            myElement.setAttribute('onmouseover', 'show(\'<mt:var name="id_prefix">list-image-<mt:AssetID>\', window.parent.document)');
            myElement.setAttribute('onmouseout','hide(\'<mt:var name="id_prefix">list-image-<mt:AssetID>\', window.parent.document)');
        </mt:If>
        myElement.appendChild(myAssetLink);
        myElement.appendChild(myRemoveLink);

        // I HATE IE!
        if (document.attachEvent) {
            var oldLis = window.parent.document.getElementById("<mt:var name="id_prefix">asset-list").innerHTML;
            var newLi  = '<li id="<mt:var name="id_prefix">list-asset-<mt:AssetID>" onmouseover="show(\'<mt:var name="id_prefix">list-image-<mt:AssetID>\', window.parent.document)" onmouseout="hide(\'<mt:var name="id_prefix">list-image-<mt:AssetID>\', window.parent.document)">' + myElement.innerHTML + '</li>';
            window.parent.document.getElementById("<mt:var name="id_prefix">asset-list").innerHTML = oldLis + newLi;
        } 
        else {
            window.parent.document.getElementById("<mt:var name="id_prefix">asset-list").appendChild(myElement);
        }

        // create the image thumbnail if it exists
        <mt:If name="asset_class" eq="image">
            var myImageElement = window.document.createElement('img');
            myImageElement.setAttribute('id', '<mt:var name="id_prefix">list-image-<mt:AssetID>');
            myImageElement.setAttribute('src', '<mt:AssetThumbnailURL width="100" encode_js="1">');
            myImageElement.setAttribute('class', 'list-image hidden');
            myElement.appendChild(myImageElement);
        </mt:If>
    }
</mt:Assets>
}
<mt:unless name="extension_message">
  parent.jQuery.fn.mtDialog.close();
</mt:unless>
/* ]]> */
</script>

<mt:if name="extension_message">
  <mtapp:statusmsg
     id="extension-changed"
     class="success"
     can_close="0">
    <mt:var name="extension_message" escape="html">
  </mtapp:statusmsg>

  <div class="actions-bar">
    <form action="" method="get" onsubmit="return false">
      <button
         type="submit"
         accesskey="x"
         class="cancel button mt-close-dialog"
         title="<__trans phrase="Close (x)">">
        <__trans phrase="Close"></button>
    </form>
  </div>
</mt:if>

<mt:include name="dialog/footer.tmpl">
